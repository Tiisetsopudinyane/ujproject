{% extends "base.html" %} {% block buttons %}
<ul class="navbar-nav ml-auto">
  <li class="nav-item p-2">
   <a 
    name=""
    type="buttton"
    class="btn btn-primary"
    href="#"
   >
    <i class="fas fa-home"></i>
    Home
   </a>
  </li>
  <li class="nav-item p-2">
    <a
    name=""
    type="button"
    class="btn btn-primary"
    href="{{ url_for('loadmessages') }}"
    ><i class="fas fa-envelope directMessages"></i> Direct
    Messages</a
  >
  </li>
  <li class="nav-item p-2">
    <a
      name="createPost_{{ user.user_id }}"
      type="button"
      class="btn btn-primary"
      href="{{ url_for('createNewPost') }}"
    ><i class="fas fa-user-plus"></i>
      Create Post
    </a>
  </li>
  <li class="nav-item p-2">
    <a
      type="button"
      name="logout"
      class="logout btn btn-primary"
      href="{{url_for('logout')}}"
      ><i class="fas fa-sign-out-alt"></i>
      Log-out
    </a>
  </li>
</ul>
{% endblock buttons %} {% block content %}

<div class="row header">
  <div class="container">
    <div class="content-posts">
      <div class="col-3 col-md-3 col-sm-5 bio-container">
        <div class="col-md-12">
          <div class="row image_user_infor">
            <div class="box"></div>
            <div class="image_border">
              {% if not user['images'] %}
              <img
                src="../static/images/user.png"
                class="img-fluid rounded-circle mb-3"
                alt="User Image"
              />
              {% else %}
              <img
                src="../{{user.images}}"
                class="img-fluid rounded-circle mb-3"
                alt="User Image"
              />
              {% endif %}
              <h4>
                <a href="{{ url_for('userProfile') }}"
                  >{{ user.first_name }} {{ user.last_name }}
                  <i class="fa fa-pencil-alt edit"></i
                ></a>
              </h4>
            </div>
            <div class="col-md-5 dm_occ">
             
              <p>Occupation: {{ user.occupation }}</p>
            </div>
          </div>
          <p>Gender: {{ user.gender }}</p>
          <hr />
          <p>Bio: {{ user.bio }}</p>
        </div>
      </div>

      <div class="col-5 col-md-5 col-sm-5 content-div">
        <div class="row">
          <div class="card">
            <div class="card-header listcategory">
              <h1>Innovators Category</h1>
            </div>
            <div class="card-body">
              <div class="container category">
                <a
                  href="{{url_for('loadposts',name='agriculture')}}"
                  class="btn gradient-div"
                  name="agriculture"
                >
                  <span></span> Agriculture
                </a>
                <a
                  href="{{url_for('loadposts',name='healthcare')}}"
                  class="btn gradient-div"
                  name="healthcare"
                >
                  <span></span> HealthCare
                </a>
                <a
                  href="{{url_for('loadposts',name='technology')}}"
                  class="btn gradient-div"
                  name="technology"
                >
                  <span></span> Technology
                </a>
                <a
                  href="{{url_for('loadposts',name='energy')}}"
                  class="btn gradient-div"
                  name="energy"
                >
                  <span></span> Energy
                </a>
                <a
                  href="{{url_for('loadposts',name='education')}}"
                  class="btn gradient-div"
                  name="education"
                >
                  <span></span> Education
                </a>
                <a
                  href="{{url_for('loadposts',name='manufacturing')}}"
                  class="btn gradient-div"
                  name="manufacturing"
                >
                  <span></span> Manufacture
                </a>
                <a
                  href="{{url_for('loadposts',name='finance')}}"
                  class="btn gradient-div"
                  name="finance"
                >
                  <span></span> Finace
                </a>
                <a
                  href="{{url_for('loadposts',name='transport')}}"
                  class="btn gradient-div"
                  name="transport"
                >
                  <span></span> Transportation
                </a>
                <a
                  href="{{url_for('loadposts',name='environment')}}"
                  class="btn gradient-div"
                  name="environment"
                >
                  <span></span> Environment
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-3 col-md-3 col-sm-5 bio-container">
        <div class="campaign">
          <h2>HealthGenius - Advancing Personalized Healthcare</h2>
          <p>
            <strong>Overview:</strong> HealthGenius is a healthcare startup
            leveraging AI and data analytics to personalize treatment plans and
            improve patient outcomes.
          </p>
          <button class="btn btn-primary" onclick="toggleReadMore('health')">
            Read More
          </button>
          <div id="health" class="read-more">
            <p><strong>Funding Goal:</strong> $30,000</p>
            <p><strong>Duration:</strong> 60 days</p>
            <p>
              <strong>Description:</strong> Our platform analyzes patient data
              to provide personalized treatment recommendations, reducing
              healthcare costs and improving patient satisfaction.
            </p>
          </div>
        </div>

        <div class="campaign">
          <h2>CleanTech Solutions - Sustainable Energy for Tomorrow</h2>
          <p>
            <strong>Overview:</strong> CleanTech Solutions develops renewable
            energy technologies to address climate change and promote
            sustainable development.
          </p>
          <button class="btn btn-primary" onclick="toggleReadMore('health')">
            Read More
          </button>
          <div id="clean" class="read-more">
            <p><strong>Funding Goal:</strong> $70,000</p>
            <p><strong>Duration:</strong> 90 days</p>
            <p>
              <strong>Description:</strong> Our innovative solar and wind energy
              solutions offer clean and affordable alternatives to traditional
              fossil fuels, helping to combat climate change.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mt-5"></div>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script>
    function toggleReadMore(id) {
      var moreText = document.getElementById(id);
      if (moreText.style.display === "none") {
        moreText.style.display = "block";
      } else {
        moreText.style.display = "none";
      }
    }

    (() => {
      console.log(name);
      function fetchPostCount(name) {
        console.log(name);
        fetch(`/count/${name}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json(); // Assuming the API returns JSON
          })
          .then((data) => {
            if ("count" in data) {
              var countSpan = button.querySelector("span");
              if (countSpan) {
                countSpan.textContent = `(${data.count}) `;
              }
            } else if ("message" in data) {
              console.log(data.message);
            } else {
              console.log("Unknown response format");
            }
          })
          .catch((error) => {
            console.error(
              "There was a problem with the fetch operation:",
              error
            );
          });
      }

      var buttons = document.querySelectorAll(".gradient-div");
      // Attach fetchPostCount function to each button's onclick event
      buttons.forEach((button) => {
        button.addEventListener("click", function () {
          console.log("button " + button.getAttribute("name"));
          fetchPostCount(button.getAttribute("name"));
        });
      });
    })();

    function loadComentsInfinityScrolling(post) {
      let count = 0;
      const container = document.getElementsByClassName("postContainer");
      while (count < post.length) {
        container.appendChild(post);
      }
    }

    var like_icon = document.getElementById("like_icon");
    var btn_like = document.getElementById("btn_like");
    var like_text = document.getElementById("like_text");
    function Togglebtn() {
      if (like_icon.style.color === "white") {
        like_icon.style.color = "blue";
        btn_like.style.backgroundColor = "white";
        like_text.innerText = "Like";
        btn_like.style.color = "blue"; // Change text color to blue
      } else {
        like_icon.style.color = "white";
        btn_like.style.backgroundColor = "blue";
        like_text.innerText = "Liked";
        btn_like.style.color = "white"; // Change text color to white
      }
    }

    async function fetchPosts() {
      try {
        const response = await fetch("/loadpost");
        if (!response.ok) {
          throw new Error(`Failed to fetch posts: ${response.statusText}`);
        }
        const data = await response.json();
        console.log(data);
        return data;
      } catch (error) {
        console.error("Error fetching posts:", error);
        return [];
      }
    }

    // Function to render posts using Handlebars.js
    async function renderPosts() {
      const postsContainer = document.getElementById("postsContainer");
      const postTemplate = document.getElementById("postTemplate").innerHTML;

      // Fetch posts
      const posts = await fetchPosts();

      // Compile Handlebars template
      const template = Handlebars.compile(postTemplate);

      const html = template({ posts });
      postsContainer.innerHTML = html;
    }

    // Render posts when the page loads
    document.addEventListener("DOMContentLoaded", renderPosts);
  </script>
</div>
{% endblock content %}
